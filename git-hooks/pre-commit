#!/bin/bash
ROOT=$(git rev-parse --show-toplevel 2>/dev/null)
[ -z "$ROOT" ] && exit 0

# Escape Rosetta poisoning on Apple Silicon
if [ "$(uname -s)" = "Darwin" ] && [ "$(sysctl -n hw.optional.arm64 2>/dev/null)" = "1" ]; then
  if [ "$(uname -m)" != "arm64" ]; then
    exec arch -arm64 node "$ROOT/scripts/format-staged.js"
  fi
fi

exec node "$ROOT/scripts/format-staged.js"
